<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1'/>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <title>PARSER</title>
    <link rel="stylesheet" type="text/css" href="global.css">
    <style>
        input:focus {
            background: #FA6;
            outline: none;
        }
        table {width: 100%;}
        input{
            width:100%;text-align: right;
            font-size:18px;
        }
        input[type=submit]{
            width:auto;
        }
    </style>
    <script>
        function GetValue() {
            var http_request = new XMLHttpRequest();
            http_request.overrideMimeType('application/json');
            http_request.onreadystatechange = function(){
                if (http_request.readyState === 4  ){
                    try{
                        var json = JSON.parse(http_request.responseText);
                        var terminal = json.trm;
                        for (var entry in terminal) {
                            var t = terminal[entry];
                            if (t.name === "parser"){
                                for (value in t ){
                                    try {
                                        if(document.getElementById(value).type === 'checkbox'){
                                            document.getElementById(value).checked = t[value];
                                        }else
                                            document.getElementById(value).value = t[value];
                                    }catch (e){}
                                }
                            }
                        }
                    }catch(e){
                        alert(e.toString());
                    }finally {

                    }
                }
            };
            http_request.open("GET", "/terminal.json", true);
            http_request.send(null);
        }
        function submitForm(f) {
            var form = document.getElementById(f);
            var formData = new FormData(form);
            var request = new XMLHttpRequest();
            request.onreadystatechange = function(){
                if (this.readyState === 4 ){
                    if (this.status === 200){
                        alert("Настройки сохранены успешно!");
                        window.location.replace("/");
                    }else if (this.status === 400){
                        alert("Ошибка при сохранении настроек")
                    }
                }
            };
            request.onerror = function(){aler("ошибка")};
            request.open('POST','/trm',true);
            request.send(formData);
        }
        window.onload = function () {
            GetValue();
        };
    </script>
</head>
<body>
<a href="/"  class="btn btn--s btn--blue">&lt;</a>&nbsp;&nbsp;<strong>ПАРСЕР</strong>
<hr>
<form id="form_id" action='javascript:submitForm("form_id")'>
    <table>
        <tr>
            <td>Символ синхронизации</td>
            <td><input type="number" title="Символ с которого начинается передача данных в формате DEC" maxlength="1" id='syn_id' name='syn' placeholder='Символ синхронизации'></td>
        </tr>
        <tr>
            <td>Индекс начала</td>
            <td><input type="number" title="Индекс начала данных для использования" id='str_id' name='str' placeholder='Индекс начала'></td>
        </tr>
        <tr>
            <td>Индекс конца</td>
            <td><input type="number" title="Индекс конца данных для использования" id='end_id' name='end' placeholder='Индекс конца'></td>
        </tr>
        <tr>
            <td>Лишний символ</td>
            <td><input type="number" title="Символы которые надо удалить в формате DEC" maxlength="1" id='trm_id' name='trm' placeholder='Лишний символ'></td>
        </tr>
        <tr>
            <td>Перевернуть</td>
            <td><input type="checkbox" title="Выбрать если данные надо перевернуть" id='rev_id' name='rev' placeholder='Перевернуть данные'></td>
        </tr>
        <tr>
            <td></td>
            <td><input type='submit' value='СОХРАНИТЬ' /></td>
        </tr>
    </table>
</form>
<hr>
<footer align="center">2018 © Powered by www.scale.in.ua</footer>
</body>
</html>